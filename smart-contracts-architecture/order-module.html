<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Order Module - Satoru Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded "><a href="../getting-started/index.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/prerequisites.html"><strong aria-hidden="true">1.1.</strong> Prerequisites</a></li><li class="chapter-item expanded "><a href="../getting-started/build.html"><strong aria-hidden="true">1.2.</strong> Build the contracts</a></li><li class="chapter-item expanded "><a href="../getting-started/test.html"><strong aria-hidden="true">1.3.</strong> Test the contracts</a></li></ol></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/index.html"><strong aria-hidden="true">2.</strong> Smart contracts architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../smart-contracts-architecture/overview.html"><strong aria-hidden="true">2.1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/adl-module.html"><strong aria-hidden="true">2.2.</strong> Adl Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/bank-module.html"><strong aria-hidden="true">2.3.</strong> Bank Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/callback-module.html"><strong aria-hidden="true">2.4.</strong> Callback Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/chain-module.html"><strong aria-hidden="true">2.5.</strong> Chain Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/config-module.html"><strong aria-hidden="true">2.6.</strong> Config Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/data-module.html"><strong aria-hidden="true">2.7.</strong> Data Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/deposit-module.html"><strong aria-hidden="true">2.8.</strong> Deposit Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/exchange-module.html"><strong aria-hidden="true">2.9.</strong> Exchange Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/feature-module.html"><strong aria-hidden="true">2.10.</strong> Feature Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/fee-module.html"><strong aria-hidden="true">2.11.</strong> Fee Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/gas-module.html"><strong aria-hidden="true">2.12.</strong> Gas Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/liquidation-module.html"><strong aria-hidden="true">2.13.</strong> Liquidation Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/market-module.html"><strong aria-hidden="true">2.14.</strong> Market Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/mock-module.html"><strong aria-hidden="true">2.15.</strong> Mock Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/nonce-module.html"><strong aria-hidden="true">2.16.</strong> Nonce Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/oracle-module.html"><strong aria-hidden="true">2.17.</strong> Oracle Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/order-module.html" class="active"><strong aria-hidden="true">2.18.</strong> Order Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/position-module.html"><strong aria-hidden="true">2.19.</strong> Position Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/price-module.html"><strong aria-hidden="true">2.20.</strong> Price Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/pricing-module.html"><strong aria-hidden="true">2.21.</strong> Pricing Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/reader-module.html"><strong aria-hidden="true">2.22.</strong> Reader Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/referral-module.html"><strong aria-hidden="true">2.23.</strong> Referral Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/role-module.html"><strong aria-hidden="true">2.24.</strong> Role Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/router-module.html"><strong aria-hidden="true">2.25.</strong> Router Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/swap-module.html"><strong aria-hidden="true">2.26.</strong> Swap Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/utils-module.html"><strong aria-hidden="true">2.27.</strong> Utils Module</a></li><li class="chapter-item expanded "><a href="../smart-contracts-architecture/withdrawal-module.html"><strong aria-hidden="true">2.28.</strong> Withdrawal Module</a></li></ol></li><li class="chapter-item expanded "><a href="../continuous-integration/index.html"><strong aria-hidden="true">3.</strong> Continuous Integration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../continuous-integration/workflows.html"><strong aria-hidden="true">3.1.</strong> Github Workflows Documentation</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Satoru Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/keep-starknet-strange/satoru/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/keep-starknet-strange/satoru/book/src/smart-contracts-architecture/order-module.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="order-module"><a class="header" href="#order-module">Order Module</a></h1>
<p>The Order Module is key for handling orders in the system. It’s important for changing, processing, and looking after orders.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>This module centralizes the logic related to orders, managing various aspects including processing increasing and decreasing orders, structuring orders, and providing utilities for common order-related operations. Its design allows developers to interact with, modify, or extend the functionalities with ease and precision.</p>
<h2 id="smart-contracts"><a class="header" href="#smart-contracts">Smart Contracts</a></h2>
<ul>
<li><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/order/order_vault.cairo">OrderVault.cairo</a>: Acts as a secure vault for orders, ensuring their safe storage and accessibility.</li>
</ul>
<h2 id="cairo-library-files"><a class="header" href="#cairo-library-files">Cairo Library Files</a></h2>
<h3 id="base_order_utilscairo"><a class="header" href="#base_order_utilscairo"><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/order/base_order_utils.cairo">base_order_utils.cairo</a></a></h3>
<p>A collection of essential functions facilitating common order-related operations, enhancing code reusability and organization.</p>
<h3 id="decrease_order_utilscairo"><a class="header" href="#decrease_order_utilscairo"><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/order/decrease_order_utils.cairo">decrease_order_utils.cairo</a></a></h3>
<p>Contains functions aiding in the processing of decreasing orders, ensuring their accurate and efficient handling.</p>
<h3 id="increase_order_utilscairo"><a class="header" href="#increase_order_utilscairo"><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/order/increase_order_utils.cairo">increase_order_utils.cairo</a></a></h3>
<p>Comprises functions to assist in processing increasing orders, maintaining precision and efficiency in operations.</p>
<h3 id="ordercairo"><a class="header" href="#ordercairo"><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/order/order.cairo">order.cairo</a></a></h3>
<p>Defines the structure for orders, serving as a blueprint for order objects within the system.</p>
<h3 id="order_utilscairo"><a class="header" href="#order_utilscairo"><a href="https://github.com/keep-starknet-strange/satoru/blob/main/src/order/order_utils.cairo">order_utils.cairo</a></a></h3>
<p>Encompasses various order-related functions, offering utilities to streamline order processing and management.</p>
<h2 id="detailed-structure-and-types"><a class="header" href="#detailed-structure-and-types">Detailed Structure and Types</a></h2>
<h3 id="order"><a class="header" href="#order"><code>Order</code></a></h3>
<ul>
<li>Represents the blueprint for creating order objects, defining the properties and characteristics of an order within the system.</li>
</ul>
<h4 id="properties"><a class="header" href="#properties">Properties</a></h4>
<ul>
<li><strong>key</strong>: A unique identifier of the order of type <code>felt252</code>.</li>
<li><strong>order_type</strong>: Specifies the type of order from the enumerated <code>OrderType</code>.</li>
<li><strong>decrease_position_swap_type</strong>: Specifies the type of swap for decreasing position orders from the enumerated <code>DecreasePositionSwapType</code>.</li>
<li><strong>account</strong>: The account of the user creating the order, represented as a <code>ContractAddress</code>.</li>
<li><strong>receiver</strong>: The receiver for any token transfers, represented as a <code>ContractAddress</code>.</li>
<li><strong>callback_contract</strong>: The contract to call for callbacks, represented as a <code>ContractAddress</code>.</li>
<li><strong>ui_fee_receiver</strong>: The UI fee receiver, represented as a <code>ContractAddress</code>.</li>
<li><strong>market</strong>: The trading market's contract address.</li>
<li><strong>initial_collateral_token</strong>: The initial collateral token for increase orders, represented as a <code>ContractAddress</code>.</li>
<li><strong>swap_path</strong>: An array of market addresses to swap through.</li>
<li><strong>size_delta_usd</strong>: The requested change in position size, represented as <code>u128</code>.</li>
<li><strong>initial_collateral_delta_amount</strong>: Represents different amounts based on the order, either the amount of the initialCollateralToken sent in by the user for increase orders, the amount of the position's collateralToken to withdraw for decrease orders, or the amount of initialCollateralToken sent in for the swap, represented as <code>u128</code>.</li>
<li><strong>trigger_price</strong>: The trigger price for non-market orders, represented as <code>u128</code>.</li>
<li><strong>acceptable_price</strong>: The acceptable execution price for increase/decrease orders, represented as <code>u128</code>.</li>
<li><strong>execution_fee</strong>: The execution fee for keepers, represented as <code>u128</code>.</li>
<li><strong>callback_gas_limit</strong>: The gas limit for the callbackContract, represented as <code>u128</code>.</li>
<li><strong>min_output_amount</strong>: The minimum output amount for decrease orders and swaps, represented as <code>u128</code>.</li>
<li><strong>updated_at_block</strong>: The block at which the order was last updated, represented as <code>u64</code>.</li>
<li><strong>is_long</strong>: Boolean flag indicating whether the order is for a long or short.</li>
<li><strong>is_frozen</strong>: Boolean flag indicating whether the order is frozen.</li>
</ul>
<h3 id="enumerations"><a class="header" href="#enumerations">Enumerations</a></h3>
<h4 id="ordertype"><a class="header" href="#ordertype"><code>OrderType</code></a></h4>
<p>Enumerates the various types of orders that can be created in the system, including MarketSwap, LimitSwap, MarketIncrease, LimitIncrease, MarketDecrease, LimitDecrease, StopLossDecrease, and Liquidation.</p>
<h4 id="decreasepositionswaptype"><a class="header" href="#decreasepositionswaptype"><code>DecreasePositionSwapType</code></a></h4>
<p>Indicates whether the decrease order should swap the pnl token to collateral token or vice versa, with possible values being NoSwap, SwapPnlTokenToCollateralToken, and SwapCollateralTokenToPnlToken.</p>
<h4 id="secondaryordertype"><a class="header" href="#secondaryordertype"><code>SecondaryOrderType</code></a></h4>
<p>Further differentiates orders, with possible values being None and Adl.</p>
<h2 id="core-functionalities-and-methods"><a class="header" href="#core-functionalities-and-methods">Core Functionalities and Methods</a></h2>
<h3 id="touch"><a class="header" href="#touch"><code>touch</code></a></h3>
<p>Updates the <code>updated_at_block</code> property of the order to the current block number.</p>
<h3 id="ordertypeinto"><a class="header" href="#ordertypeinto"><code>OrderTypeInto</code></a></h3>
<p>Converts the enumerated <code>OrderType</code> to a <code>felt252</code> type.</p>
<h3 id="ordertypeprintimpl"><a class="header" href="#ordertypeprintimpl"><code>OrderTypePrintImpl</code></a></h3>
<p>Prints the corresponding string representation of the <code>OrderType</code>.</p>
<h3 id="secondaryordertypeprintimpl"><a class="header" href="#secondaryordertypeprintimpl"><code>SecondaryOrderTypePrintImpl</code></a></h3>
<p>Prints the corresponding string representation of the <code>SecondaryOrderType</code>.</p>
<h3 id="decreasepositionswaptypeprintimpl"><a class="header" href="#decreasepositionswaptypeprintimpl"><code>DecreasePositionSwapTypePrintImpl</code></a></h3>
<p>Prints the corresponding string representation of the <code>DecreasePositionSwapType</code>.</p>
<h3 id="defaultorder"><a class="header" href="#defaultorder"><code>DefaultOrder</code></a></h3>
<p>Provides a default implementation for creating a new <code>Order</code> instance with default values.</p>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<p>The module delineates specific error cases to manage anomalies and invalid operations related to orders, ensuring seamless execution of order operations and facilitating troubleshooting and debugging.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../smart-contracts-architecture/oracle-module.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../smart-contracts-architecture/position-module.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../smart-contracts-architecture/oracle-module.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../smart-contracts-architecture/position-module.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
